<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=aXY90PUGEe2xXzDD2o3m2GGW14BssNoY"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/library/Heatmap/2.0/src/Heatmap_min.js"></script>
    <title>热力图功能示例</title>
    <style type="text/css">
        ul,
        li {
            list-style: none;
            margin: 0;
            padding: 0;
            float: left;
        }

        html {
            height: 100%
        }

        body {
            height: 100%;
            margin: 0px;
            padding: 0px;
            font-family: "微软雅黑";
        }

        #container {
            height: 850px;
            width: 100%;
        }

        #r-result {
            width: 100%;
        }
    </style>
</head>

<body>
    <div id="container"></div>
    <div id="r-result">
        <input type="button" onclick="openHeatmap();" value="显示热力图" /><input type="button" onclick="closeHeatmap();"
            value="关闭热力图" />
    </div>
</body>

</html>
<script type="text/javascript">
    var map = new BMap.Map("container");          // 创建地图实例

    var point = new BMap.Point(113.418261, 39.921984);
    map.centerAndZoom(point, 5);             // 初始化地图，设置中心点坐标和地图级别
    map.enableScrollWheelZoom(); // 允许滚轮缩放

    var points = [
        { "lat": 30.679942845419564, "lng": 104.06792346330406, "count": 131 },
        { "lat": 37.89027705396754, "lng": 112.5508635890553, "count": 75 },
        { "lat": 23.12004910207623, "lng": 113.30764967515182, "count": 149 },
        { "lat": 34.60154896700999, "lng": 119.17387221741889, "count": 26 },
        { "lat": 31.86694226068694, "lng": 117.28269909168304, "count": 63 },
        { "lat": 30.4639838878878, "lng": 106.63572033136818, "count": 32 },
        { "lat": 36.60930792847117, "lng": 114.4826939323422, "count": 34 },
        { "lat": 38.88656454802744, "lng": 115.49481016907626, "count": 194 },
        { "lat": 31.36601978754301, "lng": 118.38410842322828, "count": 33 },
        { "lat": 34.36408080974784, "lng": 107.17064545238307, "count": 43 },
        { "lat": 24.901652383991102, "lng": 118.60036234322938, "count": 99 },
        { "lat": 36.10521490127382, "lng": 120.38442818368189, "count": 88 },
        { "lat": 28.457622553937274, "lng": 117.95546387714894, "count": 32 },
        { "lat": 38.048958314615454, "lng": 114.52208184420766, "count": 88 },
        { "lat": 36.20166438574343, "lng": 113.12029208572514, "count": 43 },
        { "lat": 23.383908453269196, "lng": 116.72865028834109, "count": 88 },
        { "lat": 26.62990674144093, "lng": 106.7091770961758, "count": 102 },
        { "lat": 33.62374081814082, "lng": 114.65410194229541, "count": 42 },
        { "lat": 31.688528158880025, "lng": 118.515881846623, "count": 20 },
        { "lat": 44.308258980430466, "lng": 86.04186492219485, "count": 13 },
        { "lat": 22.57511678345104, "lng": 113.07812534115365, "count": 40 },
        { "lat": 28.21347823085322, "lng": 112.9793527876505, "count": 770 },
        { "lat": 37.53656156285964, "lng": 121.30955503008511, "count": 40 },
        { "lat": 38.50262101187604, "lng": 106.2064786078384, "count": 17 },
        { "lat": 27.236811244922414, "lng": 111.46152540355403, "count": 13 },
        { "lat": 36.09974544358536, "lng": 111.53878759640808, "count": 55 },
        { "lat": 33.379861877120995, "lng": 120.14887181793894, "count": 70 },
        { "lat": 34.277799897830626, "lng": 108.95309827919623, "count": 90 },
        { "lat": 34.80185417583674, "lng": 114.35164211776365, "count": 20 },
        { "lat": 20.022071276952243, "lng": 110.3308018483363, "count": 50 },
        { "lat": 25.84529553634676, "lng": 114.9359090792838, "count": 50 },
        { "lat": 35.07240907439113, "lng": 118.34076823661057, "count": 100 },
        { "lat": 22.80649293560261, "lng": 108.29723355586638, "count": 30 },
        { "lat": 45.7732246332393, "lng": 126.65771685544611, "count": 60 },
        { "lat": 23.043023815368237, "lng": 113.76343399075655, "count": 100 },
        { "lat": 28.689578000141147, "lng": 115.89352754583604, "count": 10 },
        { "lat": 34.5023579758288, "lng": 109.48393269657977, "count": 30 },
        { "lat": 41.808644783515746, "lng": 123.43279092160505, "count": 80 },
        { "lat": 34.756610064140254, "lng": 113.64964384986449, "count": 340 },
        { "lat": 31.227203440768868, "lng": 121.49607206403445, "count": 230 },
        { "lat": 22.546053546205247, "lng": 114.0259736573215, "count": 254 },
        { "lat": 30.71005418436643, "lng": 108.41343863669852, "count": 998 },
        { "lat": 23.11353985240842, "lng": 114.41065807997101, "count": 20 },
        { "lat": 30.58108412692075, "lng": 114.31620010268132, "count": 500 },
        { "lat": 31.50470125806144, "lng": 104.70551897529307, "count": 10 },
        { "lat": 34.65736781765111, "lng": 112.44752476895121, "count": 20 },
        { "lat": 37.74692904585666, "lng": 115.68622865290865, "count": 10 },
        { "lat": 26.89816441535812, "lng": 112.58381881071617, "count": 20 },
        { "lat": 25.049153100453157, "lng": 102.71460113878045, "count": 250 },
        { "lat": 39.51861062508462, "lng": 116.70360222263986, "count": 50 },
        { "lat": 32.47605327483028, "lng": 119.91960601619071, "count": 20 },
        { "lat": 32.31735059538377, "lng": 118.32457035097686, "count": 20 },
        { "lat": 30.800965168237234, "lng": 106.10555398379239, "count": 30 },
        { "lat": 39.12480884470283, "lng": 117.20281365402627, "count": 30 },
        { "lat": 36.06422552504259, "lng": 103.8233054407292, "count": 40 },
        { "lat": 33.57627868848315, "lng": 114.04606140022909, "count": 30 },
        { "lat": 30.877925155690896, "lng": 120.13724316328172, "count": 10 },
        { "lat": 39.93857401298612, "lng": 116.42188470126446, "count": 98 },
        { "lat": 36.640738611957964, "lng": 101.76792098980276, "count": 20 },
        { "lat": 31.317987367952437, "lng": 120.61990711548988, "count": 40 },
        { "lat": 33.08156897815767, "lng": 107.04547762872542, "count": 20 },
        { "lat": 30.537897817381097, "lng": 117.0587387721073, "count": 55 },
        { "lat": 40.81118849110306, "lng": 114.89378153032918, "count": 10 },
        { "lat": 32.05723550180587, "lng": 118.77807440802562, "count": 80 },
        { "lat": 31.131139652701417, "lng": 104.40239781824484, "count": 40 },
        { "lat": 36.68278472716141, "lng": 117.02496706629023, "count": 120 },
        { "lat": 31.57003745192303, "lng": 120.30545590053595, "count": 60 },
        { "lat": 25.448450136734262, "lng": 119.07773096395962, "count": 20 },
        { "lat": 32.98315815409348, "lng": 114.04915354745555, "count": 20 },
        { "lat": 40.828318873081585, "lng": 111.6603505200542, "count": 40 },
        { "lat": 35.75329788820758, "lng": 115.02662744067226, "count": 40 },
        { "lat": 28.31795079367364, "lng": 109.74574580039429, "count": 10 },
        { "lat": 43.89833760709784, "lng": 125.31364242720072, "count": 10 },
        { "lat": 29.10289910539069, "lng": 119.65257570368145, "count": 43 },
        { "lat": 30.293966004922325, "lng": 113.38744819357841, "count": 20 },
        { "lat": 34.80788307838604, "lng": 117.27930538329689, "count": 40 },
        { "lat": 39.6505309225366, "lng": 118.18345059773411, "count": 40 },
        { "lat": 27.89239290366571, "lng": 102.25959080320287, "count": 40 },
        { "lat": 37.069531196911996, "lng": 114.52048681294414, "count": 50 },
        { "lat": 34.43858864024636, "lng": 115.64188568785016, "count": 50 },
        { "lat": 43.84038034721766, "lng": 87.56498774111579, "count": 40 },
        { "lat": 24.30457060603053, "lng": 116.12640309836864, "count": 30 },
        { "lat": 29.885258965918055, "lng": 121.57900597258933, "count": 20 },
        { "lat": 36.23365413364694, "lng": 117.68466691247161, "count": 20 },
        { "lat": 23.035094840514382, "lng": 113.1340256353934, "count": 20 },
        { "lat": 34.34537299599856, "lng": 108.70750927819563, "count": 20 },
        { "lat": 33.96002330536412, "lng": 116.79144742863005, "count": 33 },
        { "lat": 43.17552470112557, "lng": 124.39138207367984, "count": 25 },
        { "lat": 37.52878708125143, "lng": 122.09395836580605, "count": 24 },
        { "lat": 24.329053352467223, "lng": 109.42240181015114, "count": 24 },
        { "lat": 27.954545170269935, "lng": 116.36091886693136, "count": 16 },
        { "lat": 28.002837594041246, "lng": 120.6906347337091, "count": 45 },
        { "lat": 31.771396744684242, "lng": 119.98186101345706, "count": 25 },
        { "lat": 35.586056241828416, "lng": 104.62663760066474, "count": 14 },
        { "lat": 27.557482901172786, "lng": 109.9869587958539, "count": 63 },
        { "lat": 34.27155343109188, "lng": 117.18810662317686, "count": 44 },
        { "lat": 41.14124802295616, "lng": 122.07322781023007, "count": 14 },
        { "lat": 32.441040158428244, "lng": 105.81968693999652, "count": 41 },
        { "lat": 30.73275781802591, "lng": 111.31098109196083, "count": 14 },
        { "lat": 23.757250850469006, "lng": 114.71372147587483, "count": 25 },
        { "lat": 27.113847650157084, "lng": 114.99203871092017, "count": 26 },
        { "lat": 47.33866590372683, "lng": 130.29247205063453, "count": 26 },
        { "lat": 21.472718235009687, "lng": 109.12262791919323, "count": 26 },
        { "lat": 39.33767196622064, "lng": 112.47992772666272, "count": 16 },
        { "lat": 28.76967479626591, "lng": 104.63301906152529, "count": 10 },
        { "lat": 30.927954784200963, "lng": 113.93573439207124, "count": 12 },
        { "lat": 25.0663556741861, "lng": 101.52938223914012, "count": 16 },
        { "lat": 31.23538080348789, "lng": 121.45475555700204, "count": 20 },
        { "lat": 29.71963952612237, "lng": 115.99984802155373, "count": 20 },
        { "lat": 35.03885947981193, "lng": 111.00685365308033, "count": 20 },
        { "lat": 26.435971646759207, "lng": 111.61464768615666, "count": 20 },
        { "lat": 33.606512739276326, "lng": 119.03018636465636, "count": 800 },
        { "lat": 24.489230612469232, "lng": 118.10388604566381, "count": 120 },
        { "lat": 39.81648956060153, "lng": 109.99370625145134, "count": 33 },
        { "lat": 23.661811676516503, "lng": 116.63007599086392, "count": 25 },
        { "lat": 27.811129895842885, "lng": 114.40003867155777, "count": 23 },
        { "lat": 33.0114195691165, "lng": 112.5428419005123, "count": 13 },
        { "lat": 32.64281182374795, "lng": 117.01863886329463, "count": 34 },
        { "lat": 37.86952949322259, "lng": 113.56923760163296, "count": 16 },
        { "lat": 40.03316204507791, "lng": 116.23967780102151, "count": 17 },
        { "lat": 23.547999466926136, "lng": 116.37950085538243, "count": 27 },
        { "lat": 46.65510206248248, "lng": 131.1714017395816, "count": 19 },
        { "lat": 25.520758142870502, "lng": 103.78253888802674, "count": 132 },
        { "lat": 21.66822571882161, "lng": 110.93124533067585, "count": 111 },
        { "lat": 36.455828514727976, "lng": 115.98686913929107, "count": 651 },
        { "lat": 43.87198833435933, "lng": 126.56454398883335, "count": 183 },
        { "lat": 29.599461534774647, "lng": 105.07305599171474, "count": 100 },
        { "lat": 26.04712549657293, "lng": 119.33022110712668, "count": 20 },
        { "lat": 30.33259052298605, "lng": 112.24186580719135, "count": 42 },
        { "lat": 30.34311579260133, "lng": 112.76876801685833, "count": 20 },
        { "lat": 31.214198858944734, "lng": 107.49497344658866, "count": 21 },
        { "lat": 35.26244049607468, "lng": 115.46335977452752, "count": 222 },
        { "lat": 35.3072575576613, "lng": 113.91269016082377, "count": 100 },
        { "lat": 32.014664540823446, "lng": 120.87380095093022, "count": 101 },
        { "lat": 41.57182766785653, "lng": 120.44616270273576, "count": 14 },
        { "lat": 30.259244461536102, "lng": 120.2193754157201, "count": 80 },
        { "lat": 37.48712115527602, "lng": 118.58392633307061, "count": 100 },
        { "lat": 28.668283285674367, "lng": 121.44061293593727, "count": 474 },
        { "lat": 33.87121056530193, "lng": 115.78792824511814, "count": 201 },
        { "lat": 32.636994339468124, "lng": 110.80122891676038, "count": 453 },
        { "lat": 33.74530145652439, "lng": 113.30084897797529, "count": 200 },
        { "lat": 29.600957611095073, "lng": 103.76082423877176, "count": 20 },
        { "lat": 32.90121133056961, "lng": 115.82093225904637, "count": 154 },
        { "lat": 39.945461565897574, "lng": 119.6043676161184, "count": 30 },
        { "lat": 37.69336152679759, "lng": 112.73851439991773, "count": 221 },
        { "lat": 28.4562995521443, "lng": 119.92957584318849, "count": 233 },
        { "lat": 32.70437044999437, "lng": 109.03804456347515, "count": 20 },
        { "lat": 27.699961377076246, "lng": 106.93126031648453, "count": 111 },
        { "lat": 29.124889353219793, "lng": 110.4816201569677, "count": 100 },
    ];

    if (!isSupportCanvas()) {
        alert('热力图目前只支持有canvas支持的浏览器,您所使用的浏览器不能使用热力图功能~')
    }
    //详细的参数,可以查看heatmap.js的文档 https://github.com/pa7/heatmap.js/blob/master/README.md
    //参数说明如下:
    /* visible 热力图是否显示,默认为true
     * opacity 热力的透明度,1-100
     * radius 势力图的每个点的半径大小
     * gradient  {JSON} 热力图的渐变区间 . gradient如下所示
     *	{
            .2:'rgb(0, 255, 255)',
            .5:'rgb(0, 110, 255)',
            .8:'rgb(100, 0, 255)'
        }
        其中 key 表示插值的位置, 0~1.
            value 为颜色值.
     */
    heatmapOverlay = new BMapLib.HeatmapOverlay({ "radius": 20 });
    map.addOverlay(heatmapOverlay);
    heatmapOverlay.setDataSet({ data: points, max: 100 });
    //是否显示热力图
    function openHeatmap() {
        heatmapOverlay.show();
    }
    function closeHeatmap() {
        heatmapOverlay.hide();
    }
    closeHeatmap();
    function setGradient() {
        /*格式如下所示:
        {
            0:'rgb(102, 255, 0)',
            .5:'rgb(255, 170, 0)',
            1:'rgb(255, 0, 0)'
        }*/
        var gradient = {};
        var colors = document.querySelectorAll("input[type='color']");
        colors = [].slice.call(colors, 0);
        colors.forEach(function (ele) {
            gradient[ele.getAttribute("data-key")] = ele.value;
        });
        heatmapOverlay.setOptions({ "gradient": gradient });
    }
    //判断浏览区是否支持canvas
    function isSupportCanvas() {
        var elem = document.createElement('canvas');
        return !!(elem.getContext && elem.getContext('2d'));
    }
</script>